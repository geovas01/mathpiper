

%piper,output="geogebra"  //Note: make indent level of output one more level than the indent level of the fold.  
        Write(2+2);
        
%/piper
        



%beanshell,scope="ide"
p = view.getTextArea().getPainter();



%/beanshell


%beanshell
import java.io.*;
//Print the contents of the Piper script zip file.
 instance = org.mathrider.jpiperplugin.JPiperInterpreter.getInstance();
 scriptZip = instance.getScriptsZip();
 entries = scriptZip.entries();
 
 while( entries.hasMoreElements())
 {
    element = entries.nextElement();
    System.out.println("XXXXX " + element);
 }
 
 entry = scriptZip.getEntry("assoc.rep/code.pi");
 System.out.println("YYYYYY " + entry);
 
 fis = scriptZip.getInputStream(entry);
 //
        entry = entry.toString().replaceAll("/","-");
         // Create temp file.
        File tempFile = File.createTempFile(entry, ".pi");
    
        // Delete temp file when program exits.
        tempFile.deleteOnExit();
    
	//File originFile = new File("c:\\file1.txt");
    //File destinationFile = new File("c:\\file1.txt");
    //if (!originFile.exists() || destinationFile.exists()) {
      //return;
    //}
    try {
      byte[] readData = new byte[1024];
      //FileInputStream fis = new FileInputStream(originFile);
      FileOutputStream fos = new FileOutputStream(tempFile);
      int i = fis.read(readData);

      while (i != -1) {
        fos.write(readData, 0, i);
        i = fis.read(readData);
      }
      fis.close();
      fos.flush();
      fos.close();
    } catch (IOException e) {
      System.out.println(e);
    }//end try/catch.
    
    
    
    //textArea = org.gjt.sp.jedit.jEdit.createTextArea();
    
    activeView = org.gjt.sp.jedit.jEdit.getActiveView();
    
    //buffer = org.gjt.sp.jedit.jEdit.openFile(activeView, tempFile.getAbsolutePath());
    
   // jf = new javax.swing.JFrame();
   // cf = jf.getContentPane();
   // cf.add(textArea);
   // jf.show();
   
   
				void delayDisplay()
				{
					//Buffer update needs to be done later in the AWT thread because of needing
					// to wait for the buffer to be saved (which was requested earlier).
					void run()
					{
						buffer = org.gjt.sp.jedit.jEdit.openFile(activeView, tempFile.getAbsolutePath());//

					}
					org.gjt.sp.jedit.io.VFSManager.runInAWTThread(this);
				
				}//end method.
				
	delayDisplay();



%/beanshell


%piper
c := Sum(i,1,11,1/(i*(i+1)));
Write(V(N(c)));

f := 10/(10+1);
Write(N(f));



%/piper

%piper
k := 10;
g := k/(k+1) + 1/((k+1) * ((k+1)+1));
h := (k+1) / (k+1)+1;
Write(g, h);


%/piper

%piper
Set(e,2.71828182847786963038);
f(x) = N((.6*10^-6)* D(x) 40*(e^(-15000*x))*Sin(30000*x));
Write(f(x));



%/piper


%piper
Set(e,Exp(1));
a := (.6*10^-6) * N((.6*10^-6)* D(x) 40*(e^(-15000*x))*Sin(30000*x));
Write(a);



%/piper

%piper
Set(e,2.71828);
df := D(x) 40*e^(-15000*x)*Sin(30000*x);
Write(df);


%/piper

%piper
Write(25!);


%/piper

%piper
b := (6*a + 5) / (a + 2);
Write(b);



%/piper

%piper
c := 



;
d := k * e(k-1);
%/piper



%piper

e := 2.71828;
d(x) := N(Eval((0.6*10^-6) * D(x) 40*(e^(-15000*x))*Sin(30000*x) ));
y := d(0);
Write(y);



%/piper







%piper,pipe_to="P2D_GeoGebra"
f(a) := (6*a + 5)/(a+2);
b := 1;
ForEach(x,1 .. 10)
    [
        c := f(b);
        Write(N(Eval(c)));
        b := c;
    ];



%/piper


%beanshell,name="P2D_GeoGebra",scope="global"


P2D_GeoGebra(str)
{
    //Note: show/initialize geogebra plugin before using.
    vals = str.split(" ");
    
    x = 0;
    for(val:vals)
    {
        ggb.evalCommand("(" + x++ +"," + val + ")");
    }//end for.

    output(str);
    
}

data = "3.66666666666666666667 4.76470588235294117647 4.96521739130434782609 4.99500624219725343321 4.99928609673389255756 4.99989800341688553433 4.99998542884723967725 4.99999791840241548584 4.99999970262882806839 4.99999995751840220508";
P2D_GeoGebra(data);



%/beanshell


%piper,output="latex"
    /* This is a great example problem to use in MathRider.
    1) Enter expression.
    2) If it is a complicated expression, view it in LaTeX form to make sure it has been entered
    correctly.  In this problem, if parentheses are not placed around the exponents then then the
    expression is evaluated differently than if they are present.
    3) Adjust the expression until it is correct.
    */
    
    a :=((1-x^(2*k))/(1-x))*((1-x^(2*(k+1)))/(1-x));
    Write(a);


%/piper

%piper, output="latex"

Write(Simplify(a));

    %hoteqn
      $\frac{x ^{2 k + 2 \left( k + 1\right) } - x ^{2 \left( k + 1\right) } + 1 - x ^{2 k}}{x ^{2} - 2 x + 1} $



    %/hoteqn

%/piper



%piper,output=""

    
    a := (((1-x^(2*k))/(1-x))*(1 + x^(2*(k+1)-1)));
    Write(Simplify(a));



%/piper



%piper,output=""

    
    a := Hold(((1-x^(2^k))/(1-x))*(1 + x^(2^((k+1)-1))));
    b := Hold((1-x^(2^(k+1)))/(1-x));
    Write(a:Eval(a):Simplify(a));
    //Write(TestPiper(a,b));


%/piper



%piper,output="latex"

    
    a :=  Hold((1+x^2^k) * (1-x^2^k) );
    b := Hold( 1/2 *(k+1)*(k+2) );
    Write(a:Simplify(a));



%/piper

%piper
    a := (1-x^2^k) * (1+x^2^k);
    Write(Simplify(FullForm(a)));


%/piper

%piper

a := FromString("(* 
          (- 1 
            (^ x 
              (^ 2 k )))
          (+ 
            (^ x 
              (^ 2 k ))1 ))") LispRead();
              
Write(a);



%/piper

%piper

a := FromString("(* 3 (MathSin 4))") LispRead();
              
Write(Eval(a));



%/piper





%piper
//Why doesn't this work?
a := FromString("(+ 5 .5 2.5  )") LispRead();
              
Write(Eval(a));


%/piper


%piper
//Why doesn't this work?
a := FromString("(+ 1 2 3)") LispRead();
              
Write(a);



%/piper

%piper,output="",mode="true"
//Good example problem for newbies book.  From problem 19 in "Mathematical Reasoning".
a(k) := (k+2)/(2*k+2);
b(k) := ( ((k+1)/(2*k)) * (1-(1/(k+1)^2) ) );
c(k) := (k+1)/(2*k) - (k+1)/(2*k*(k+1)^2);
d(k) := (k^3+3*k^2+2*k)/(2*k^3+4*k^2+2*k);
e(k) := (k^2+3*k+2)/(2*k^2+4*k+2);


//Write(d(k));
Write(TestPiper(a(k),e(k)));
//Write(Together(c(k)));
//Write(Simplify(c(k)));
//Write(Factor(Numer(Together(c(k)))):Factor(Denom(Together(c(k)))));



%/piper


%beanshell
ProcessBuilder pb = new ProcessBuilder("C:\\Program Files\\Maxima-5.15.0\\bin\\maxima.bat");
 //Map<String, String> env = pb.environment();
 //env.put("VAR1", "myValue");
 //env.remove("OTHERVAR");
 //env.put("VAR2", env.get("VAR1") + "suffix");
 //pb.directory("myDir");
 Process p = pb.start();
%/beanshell


%beanshell
command = new java.util.ArrayList();
command.add("C:\\Program Files\\Maxima-5.15.0\\bin\\maxima.bat");
ProcessBuilder pb = new ProcessBuilder(command);
 //Map<String, String> env = pb.environment();
 //env.put("VAR1", "myValue");
 //env.remove("OTHERVAR");
 //env.put("VAR2", env.get("VAR1") + "suffix");
 //pb.directory("myDir");
 Process p = pb.start();
 in = p.getInputStream();
 out = p.getOutputStream();
 sb = new StringBuffer();
 //cv = s.read();
 //s.read();
while(in.available() == 0)
{
}

 while(in.available() != 0)
 {
    cv = in.read();
    ch = (char)cv;
    //System.out.println("xxxx " + ch);
    sb.append(ch);
 }
 
 System.out.println("xxxx " + sb.toString());
 
 
//Write then read.
sb.delete(0,sb.length());
outmess = "2+2;\n".getBytes();
out.write(outmess);
out.flush();
 while(in.available() == 0)
{
}

 while(in.available() != 0)
 {
    cv = in.read();
    ch = (char) cv;
    //System.out.println("xxxx " + ch);
    sb.append(ch);
 }
 
  System.out.println("xxxx " + sb.toString());


%/beanshell



%beanshell
maxima() 
{
    command = new java.util.ArrayList();
    command.add("C:\\Program Files\\Maxima-5.15.0\\bin\\maxima.bat");
    pb = new ProcessBuilder(command);
    //Map<String, String> env = pb.environment();
    //env.put("VAR1", "myValue");
    //env.remove("OTHERVAR");
    //env.put("VAR2", env.get("VAR1") + "suffix");
    //pb.directory("myDir");
    Process p = pb.start();
    inputStream = p.getInputStream();
    outputStream = p.getOutputStream();
    sb = new StringBuffer();
    
    keepRunning = true;
    
    
    send(snd)
    {
    }
    
    run() 
    {
	
		
		while(keepRunning)
        {

			serialAvailable = inputStream.available();
			if(serialAvailable > 0)
            {
				byte[] bytes = new byte[serialAvailable];
				inputStream.read( bytes, 0, serialAvailable );
                System.out.println("GGGGGGG " + new String( bytes));

				//self.terminalOutputStream.write( bytes )
				
				//event = utility.DataEvent( self, bytes, self.packetMode )
				
				//self.notifyListeners( event )
            }//end if.
            
            Thread.sleep( 30 );
        }//end while.
        
    }//end run.
    return this;
    
}//end maxima.

max = maxima();

new Thread( max ).start();



%/beanshell




%maxima,name="test"
2+3;
5+7;
print("hello");

%/maxima



%beanshell,scope="ide"
v = view;
		dwm = v.getDockableWindowManager();
		con = dwm.getDockable("console");
        con.setShell("Maxima");



%/beanshell

%lisp
(defun compress (x)
    ;;If a cons was passed in then compress it.
    (if (consp x)
        (compr (car x) 1 (cdr x))
        ;;Else just return what was passed in.
        x))
        
;;; elt: element.  n: number in a sequence. lst: the rest of the list.
(defun compr (elt n lst)
    ;; If the rest of the list is null, then just call n-elts once.
    (if (null lst)
        (list (n-elts elt n))
        
        ;; If the rest of the list is not null then set the variable next to the next character in the list.
        (let ((next (car lst)))
        
            ;; If element is the same as the next character in the list then compress again.
            (if (eql next elt)
                (compr elt (+ n 1) (cdr lst))
            
                ;; If element is not the same then 
                (cons (n-elts elt n)
                    (compr next 1 (cdr lst )))))))
                
(defun n-elts (elt n)
    (if (> n 1)
        (list n elt)
        elt))



%/lisp


MAXIMA> (compress '(1 1 1))

  1> (COMPRESS (1 1 1))
    2> (COMPR 1 1 (1 1))
      3> (COMPR 1 2 (1))
        4> (COMPR 1 3 NIL)
          5> (N-ELTS 1 3)
          <5 (N-ELTS (3 1))
        <4 (COMPR ((3 1)))
      <3 (COMPR ((3 1)))
    <2 (COMPR ((3 1)))
  <1 (COMPRESS ((3 1)))
((3 1))


%lisp
(defun our-nthcdr (n lst)
    (if (zerop n)
        lst
        (our-nthcdr (- n 1) (cdr lst))))



%/lisp

MAXIMA> (our-nthcdr 2 '(a b c))

  1> (OUR-NTHCDR 2 (A B C))
    2> (OUR-NTHCDR 1 (B C))
      3> (OUR-NTHCDR 0 (C))
      <3 (OUR-NTHCDR (C))
    <2 (OUR-NTHCDR (C))
  <1 (OUR-NTHCDR (C))
(C)












%piper

    Write("Hello World!");

%/piper

    %output,preserve="false"
      "Hello World!"
    %/output


%beanshell,scope="ide"
as = Macros.getMacroActionSet();

foldOutput = as.getActions().toString();

//as = jEdit.getActionSets();



%/beanshell







%piper,name="example_1",output="pretty"

    a := x^2 + x/2 + 3;
    Write(a);

%/piper

    %output,preserve="false"
      True:
      
       2   x    
      x  + - + 3
           2
    %/output






%geogebra,clear="true"

    //Plot a function.
    f(x)=2*sin(x)
    
    //Add a tangent line to the function.
    a = 2
    (2,0)
    t = Tangent[a, f]

%/geogebra

    %output,preserve="false"
      GeoGebra updated.
    %/output





%geogebra_xml,description="Obtained from .ggb file"

    <?xml version="1.0" encoding="utf-8"?>
    <geogebra format="3.0">
    <gui>
    	<show algebraView="true" auxiliaryObjects="true" algebraInput="true" cmdList="true"/>
    	<splitDivider loc="196" locVertical="400" horizontal="true"/>
    	<font  size="12"/>
    </gui>
    <euclidianView>
    	<size  width="540" height="553"/>
    	<coordSystem xZero="215.0" yZero="315.0" scale="50.0" yscale="50.0"/>
    	<evSettings axes="true" grid="true" pointCapturing="3" pointStyle="0" rightAngleStyle="1"/>
    	<bgColor r="255" g="255" b="255"/>
    	<axesColor r="0" g="0" b="0"/>
    	<gridColor r="192" g="192" b="192"/>
    	<lineStyle axes="1" grid="10"/>
    	<axis id="0" show="true" label="" unitLabel="" tickStyle="1" showNumbers="true"/>
    	<axis id="1" show="true" label="" unitLabel="" tickStyle="1" showNumbers="true"/>
    	<grid distX="0.5" distY="0.5"/>
    </euclidianView>
    <kernel>
    	<continuous val="true"/>
    	<decimals val="2"/>
    	<angleUnit val="degree"/>
    	<coordStyle val="0"/>
    </kernel>
    <construction title="" author="" date="">
    <expression label ="f" exp="f(x) = 2 sin(x)"/>
    <element type="function" label="f">
    	<show object="true" label="true"/>
    	<objColor r="0" g="0" b="255" alpha="0.0"/>
    	<labelMode val="0"/>
    	<animation step="0.1"/>
    	<fixed val="false"/>
    	<breakpoint val="false"/>
    	<lineStyle thickness="2" type="0"/>
    </element>
    <element type="numeric" label="a">
    	<value val="2.0"/>
    	<show object="false" label="true"/>
    	<objColor r="0" g="0" b="0" alpha="0.1"/>
    	<labelMode val="1"/>
    	<animation step="0.1"/>
    	<fixed val="false"/>
    	<breakpoint val="false"/>
    </element>
    <element type="point" label="A">
    	<show object="true" label="true"/>
    	<objColor r="0" g="0" b="255" alpha="0.0"/>
    	<labelMode val="0"/>
    	<animation step="0.1"/>
    	<fixed val="false"/>
    	<breakpoint val="false"/>
    	<coords x="2.0" y="0.0" z="1.0"/>
    	<coordStyle style="cartesian"/>
    	<pointSize val="3"/>
    </element>
    <command name="Tangent">
    	<input a0="a" a1="f"/>
    	<output a0="t"/>
    </command>
    <element type="line" label="t">
    	<show object="true" label="true"/>
    	<objColor r="255" g="0" b="0" alpha="0.0"/>
    	<labelMode val="0"/>
    	<breakpoint val="false"/>
    	<coords x="0.8322936730942848" y="1.0" z="-3.4831821998399333"/>
    	<lineStyle thickness="2" type="0"/>
    	<eqnStyle style="explicit"/>
    </element>
    </construction>
    </geogebra>

%/geogebra_xml

    %output,preserve="false"
      GeoGebra updated.
    %/output
    
    


    
%beanshell
//Save image as .png file.  Clipboard code works but is low resolution.
he = new atp.sHotEqn();
he.setFontsizes(18,18,18,18);
he.setEquation("2^3");
//global.image = he.getImage();

import javax.swing.*;
import java.awt.event.*;
import java.awt.*;
docker = org.gjt.sp.jedit.jEdit.getActiveView().getDockableWindowManager();
frame = new javax.swing.JFrame();


guiBox = new Box(BoxLayout.Y_AXIS);
messageTextField = new JTextField();
guiBox.add(messageTextField);
button1 = new JButton("Grab image");
button1.setBackground(Color.green);
button1.addActionListener(this);
guiBox.add(button1);
button2 = new JButton("Close GeoGebra");
button2.setBackground(Color.red);
button2.addActionListener(this);
guiBox.add(button2);
contentPane = frame.getContentPane();
contentPane.add(guiBox,BorderLayout.NORTH);
//contentPane.add(he,BorderLayout.EAST);



//ImageIcon icon = new ImageIcon(image);
//JLabel label = new JLabel();
//label.setIcon(icon);
//panel.add(label);
contentPane.add(he);
frame.pack();
frame.setAlwaysOnTop(true);
frame.setTitle("MathRider");
frame.setSize(new Dimension(250, 200));
frame.setResizable(true);
frame.setPreferredSize(new Dimension(250, 200));
frame.setLocationRelativeTo(null); // added
frame.show();
//System.out.println("IIIIII" + image);



import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.ClipboardOwner;
import java.awt.datatransfer.Transferable;
import java.awt.datatransfer.StringSelection;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.awt.Toolkit;

    
imageSelection(Image i) 
{
    image = i;
    
    
    public Object getTransferData(DataFlavor flavor) throws UnsupportedFlavorException
    {
        if (flavor.equals(DataFlavor.imageFlavor)) 
        {
            return image;
        }
        throw new UnsupportedFlavorException(flavor);
    }
    
    public boolean isDataFlavorSupported(DataFlavor flavor) 
    {
        if (flavor.equals(DataFlavor.imageFlavor)) 
        {
            return true;
        }
        return false;
    }
    
    public DataFlavor[] getTransferDataFlavors() 
    {
        return new DataFlavor[] {DataFlavor.imageFlavor};
    }
    return this;
    
}//end





actionPerformed(event)
{
    src = event.getSource();

    if (src == button1)
    {
      image = he.getImage();
      System.out.println("IIIIIII " + image);
      ImageIcon icon = new ImageIcon(image);
      JLabel label = new JLabel();
      label.setIcon(icon);
      
      contentPane.add(new javax.swing.JPanel().add(label),BorderLayout.SOUTH);
      
      frame.invalidate();
      frame.validate();
      frame.repaint();
      
      import java.io.*;
      import java.awt.image.*;
      import javax.imageio.*;
      File myGifFile = new File("hoteqn.png");
      
      ImageIO.write(image,"png",myGifFile);
      
      
      messageTextField.setText("Grabbed image");
      
      
      temp = imageSelection(image);
      clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
      clipboard.setContents(temp,temp);
      
      
    }
    else if (src == button2)
    {
      messageTextField.setText("GeoGebra closed.");
      docker.hideDockableWindow( "geogebra" );
    }

}

%/beanshell

    %output ,preserve="false"
      
    %/output 

    
    

%beanshell


import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.ClipboardOwner;
import java.awt.datatransfer.Transferable;
import java.awt.datatransfer.StringSelection;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.UnsupportedFlavorException;
import java.awt.Toolkit;
public class ImageSelection implements Transferable
{
    private java.awt.Image image;
    public ImageSelection(Image i) 
    {
        image = i;
    }

    public Object getTransferData(DataFlavor flavor) throws UnsupportedFlavorException
    {
        if (flavor.equals(DataFlavor.imageFlavor)) 
        {
            return image;
        }
        throw new UnsupportedFlavorException(flavor);
    }

    public boolean isDataFlavorSupported(DataFlavor flavor) 
    {
        if (flavor.equals(DataFlavor.imageFlavor)) 
        {
            return true;
        }
        return false;
    }

    public DataFlavor[] getTransferDataFlavors() 
    {
        return new DataFlavor[] {DataFlavor.imageFlavor};
    }
}//end


ImageSelection temp = new ImageSelection(my_graphics.offImage);
Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
clipboard.setContents(temp,temp);
    
%/beanshell


%hoteqn

    2 x ^{3} + 14 x ^{2} +  \frac{24 x}{7}

%/hoteqn

    %output,preserve="false"
      HotEqn updated.
    %/output
    

:indentSize=4:tabSize=4:wrap=none:
