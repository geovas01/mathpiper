Development notes.

:indentSize=4:lineSeparator=\n:noTabs=false:tabSize=4:folding=explicit:collapseFolds=1

{{{====To Do
+ Sometimes the "Source" button in PiperDocs indicates it cannot load the source file using the given encoding.
+ Add "ant -Dtarget=dist all-plugins" to build instructions.
+ Add version update to welcome.html file.
+ Folds throw an exception if equals sign is missing from a parameter.  Should catch this and return a better error message (actually I discovered that it is commas between quotes that is causing the exception."
+ Check Numbers (Predicates) for completeness.
- Place all IsXXX predicate functions in the predicate node in PiperDocs.
+ Again, figure out a way for piper folds to always return the result of the
last evaluation without needing to use Write;
+ Provide a way to reset piper without relaunching MathRider.
+ Place sliding window divider between function tree window and documentation window in PiperDocs.
- Place cursor inside of description double quotes after inserting a fold.
+ Add fit function to GeoGebra so that plots can be autozoomed to fit the display area.
+ Add Clojure to MathRider.
+ Develop an Application Specific Language for GeoGebra.
+ The %geogebra fold syntax hilights the letter D.
+ If %piper is the last fold and there is less than 2 spaces below it, the output fold will not be shown.
+ Have the GeoGebra plugin associated with view the %geogebrafold was executed in show the result.
+ Automate the placing of version information in plugin documentation (including UASM65).
+ My concern is mostly "Java IDE kung-fu": users of these libraries (mostly just me :-) only want the highest level APIs to show in popup completion lists and the entire set of implementation classes remain invisible. The solution is easy: a public API class with implementation classes in the same package with package-ony (i.e., neither public or private) visibility..
+ All Functions category gives duplicates when function names contain ` characters.
+ There are other duplicate function names in All Functions.
+ Add menu items back when ready: help-menu=about help tip-of-the-day.
+ Need to work on more sophisticated fold property parser.  For example, what is a good way to part this?: (%piper,output="output,preserve="false",name="test"",name="test2").
+ Property scope="ide" throws null pointer exception when beanshell gui code is executed in worksheet_demo_1.mrw file.
+"All buffer-local properties listed in the section called Buffer-Local Properties may be given values in edit modes." so perhaps set the folding mode here instead of in the system properties file?
+ Use fold to send commands to PiperDocs plugin.  Searching might be one action to implement.
+ Does every function need to return True or False?  For example, why does PrettyForm return True while TeXForm doesn't.
+ Add beanshell error catch to beanshell fold.
+ Perhaps add grade level (or similar) tags to functions to hide advanced functions in piper docs.
+ Have Piper docs go to cateorgy's html reference page when category is selected.
+ Add scope="shell" to beanshell fold.
+ Add IsInteger to PiperDocs (There are a number of links to it, but no target).
+ Give option for Piper functions to be grouped bye type.  For example, predicates(refchap10), numeric functions(like MathSin), etc. Perhaps use a tree. 
+ Why is the MathRider startup script in the settings directory and in the MathRider directory?
+ If fold is not found then part of .mws file is deleted.
+ Place proper exception types in folds (like maxima and lisp);
- Enable menubar in geogebra plugin.
+ Add tools to geogebra toolbar which allow exporting images and xml geogebra code into notebook cells.
+ NewtonNum link in Newton is broken.
- Add default fold which will set default fold properties like output="output".
+ Add dependency code for geogebra, errorlist, etc.
+ Place path to .html file at top of docs window.
- Add output property for folds.
+ Add shortcut and button for inserting a fold into a .mws file.
+ Allow properties to not use quotes around the value.
+ Change Geogebra to GeoGebra globally.
+ Note:tk: must set output and console another way for when user executes maxima fold before using the shell.
- Change file format from .mrn to .mathrider (maybe leave .mrn to make tabs shorter.) (Actually, perhaps .mr or .mar would be better.).
+ Check if Piper remembers variable values between sessions.
+ Check to make sure that at least Sun's Java 5 is installed.
+ Do better syntax checking on fold properties.
+ Have Piper console use the text area font size (like svn does).
- Include Piper documentation in Piper plugin.
+ Make the Piper console the default console application.
+ Obtain line number when Piper encounters an error when executing a file.
+ Perhaps run Piper in its own thread so that the application does not lock up during execution.
+ Register a single error source instance and make it accessible to the <shift><click> macro.
+ Why doesn't =, :=, etc. highlight?
+ Macro which brings up checkbox for all properties for a % fold command when it is shift clicked.
+ Macro: right click menu which allows inserting of fold template.
+ Place MathRider variables in standard jEdit beanshell environment.
+ Use the ContextMenu plugin to create a special popup menu for .mws files.
+ Add dock sidekick plugin to the right side of the screen and have it show outline of .mws files.
+ "If none of the predicates are true, the function is returned with its arguments evaluated." Should "evaluated" be "unevaluated" here? (section 1.5 of the programmer's manual.
+ Use ShortCutSaver plugin for .mws shortcut keys (maybe like <shift><enter>).
+ Study TextAutocomplete plugin for ideas on keyword autocompletion.
- Fix problem where %output folds don't cause extra %ends but %error folds do.
+ Figure out a way to output the result of the last expression in a fold without Writing or Echoing.
+ Find the documentation for Apart and Together.
+ Make fold types a property for use by Shift_Enter.bsh file, mode file, and the configurable fold handler plugin.
+ Allow help on a Piper function to be brought up by ???ing on it (including the source code of the function).
+ Check to see if we can remove the C: stripping code from Shift_Enter.bsh with this: file:///C:/ted/download/piper_manual/refchapter26.html#c26". (Doesn't work, must fix bug in Piper itself).
+ Allow multiple output folds to be generated.  For example, both %latex and normal %output.
+ Add autoexecute parameter which automatically executes an output fold.
- Allow source code for any function in the standard library to be brought up in the editor (like Sage ?? command).
+ Allow font size to be adjusted for any TextArea.
+ Allow Piper Docs JEditorPane to be scrolled with the up and down arrows.
+ Allow Piper Docs JEditorPane to save bookmarks.
+ Show "breadcrumb trail" at the top of the Piper Docs window.
+ Perhaps dynamically set the mode of .mws files by what kind of fold the cursor is placed in.
+ Check MathAdd and other functions not being looked up in Piper Docs.
+ How to log exceptions
		catch(Exception e)
		{
			Log.log(Log.ERROR,this,"Bad indent rule " + prop
				+ '=' + value + ':');
			Log.log(Log.ERROR,this,e);
		}
+ Allow folds to call other folds.
+ Allow GUI components to call folds.
+ Add uasm65 mode.
+ Fold output property could specify multiple properties by entering normal|latex.
- Allow PiperDocs to show either the docs for a core function or its source code.  (Open source code in a buffer).
- Make indent level of output one more level than the indent level of the fold.
+ Fix problem of Piper not being able to find file on other drive othern than the current drive.
+ Check toc.xml error in help.
+ Make a plugin for JCalc and make it the default calculator because it is easier to understand than the RPN calculator.
+ Allow PiperDocs to have tabbed viewing area.  Allow right click on hyperlink to have option of opening in a new tab.
+ Figure out a way to have the geogebra fold set properties on mathematical objects with non-XML code.
+ Fix gray background rectangles on display.
- Add forward and back browser capabilities to Piper docs.
+ Deselect item in function list when "home" is selected in PiperDocs.
+ In PiperDocs, allow functions to be listed either alphabetically or in groups.
+ Change "jEdit Home Directory" to "MathRider Home Directory".
+ RuleBaseListed link in Echo documentation is broken.
+ If GeoGebra has not been executed yet, then the ggb BeanShell variable will contain a null reference.
+ Add multiple fold properties capability like this: %piper,output="latex,autoexecute".
+ Update PiperDocs to refer to the Java implementation instead of the C implementation.
+ Capital vs. lower case variables in an expression causes evaluation errors if not caught.  Perhaps some way to highlight these case differences can be created?
+ If bottom fold is executed, append a new fold of that type at the bottom of the document.
"accapt" needs an "s" in PiperDocs for Write function.
+ Add function that allows Piper to execute Java/BeanShell code.
+ Create a QTOT plugin for logging Quiet Time On Task hours.
+ Create a JXTA plugin for collaboration.
+ Perhaps create Piper console fold so console sessions can be preserved?
+ Backslashes \ do not continue lines in Piper console.
- PiperInterpreter is sometimes not found in BeanShell script.  Problem occures in PiperDocs "Source" request. 
+ Put exception checking on all scripts;
+ This code causes an error because of output="latex":
    %piper,description="",output="latex"
        A := {a,b,c,d};
        B := {b,d,e};
        
        Echo("A", Intersection(A,B));
        
    
    %/piper

        %error ,preserve="false"
          Expecting ) closing bracket for sub-expression, but got { instead
        %/error 
- Add quotes to mode.
- Add usage information to the Piper console.
- Change // and /**/ to same color in mode.
- Fix GeoGebra docking menu overwriting problem.
- Make a Piper mode file.
- Perhaps add properties to a fold like manipulate=true:output=latex.
- Tag folds by type, for example %piper, %latex, %uasm65, %equation.

Initial release:
+ Documentation: Main mathrider, all plugins.
+ Add GPL statement to all source code files.
+ Check GPL statements on plugins.
+ Add license for fire icon http://commons.wikimedia.org/wiki/Image:Exquisite-k3b.png.

}}}

{{{PLUGIN IDEAS
+ Plugin which has database of famous mathematicians with bio and picture.
+ Plugin which contains mathematically accurate type hierarchy (perhaps use Axiom CAS.).
}}}


{{{ MACRO IDEAS:
+ Multiple_Latex: accepts a list of values to convert to TeXForm and display.
}}}

{{{FOLD TYPES (Make sure to add fold types in Shift_Enter.bsh file, mode file and configurable fold handler plugin.)
+ piper - Executes piper code.
+ cas - Executes code using the default cas system.
+ manipulate - Allows user to manipulate an equation or inequality.
+ latex - Displays latex code using the default latex viewer.
+ geogebra - Sends geogebra commands to geogebra.
+ plot2d - Plots functions using the default 2d plotting program.
+ jmol - Sends jmol commands to jmol.
+ plot3d - Plots functions using the default 3d plotting program.
+ spreadsheet - Sends spreadsheet data to the default spreadsheet program.
+ beanshell - Sends code to beanshell.  Useful for creating GUIs, text scripts, etc.
+ html.
+ sql.
+ buffer - Code is held in a separate buffer.  May be useful for large blocks of code.

+_I_ am annoyed by having to write code to do anything: surrounding any CAS command with %piper and %/piper is irritating. Susan.



}}}


{{{PIPER BUGS.
===

(2^x)^3 evaluates to 2^x^3. compare to (say) gnu calc, which evaluates
this to 2^(3x). note that yacas evaluates (x^2)^3 to x^6.

apologies if this is is a well-known bug (or if instead it is
considered a feature)

-- eric

====
N(Pi,10) gives too many digits.
====
Functions obtained from D() do not evaluate and functions cannot be defined as follows for some reason:

y := 2 * x;

====
PathString and WriteString are not implemented yet.
====
----
NewLine(x) does not work in folds probably because of Load.  Fix?
----
9.5/3.2 does not evaluate to a decimal number.
----
TestPiper(x^k/x,x^(k-1));
Returns false but
is(equal(x**k/x,x**(k-1)));
returns true in maxima.

----
//Why does this give an error?
In> MathSin(90 * Pi / 180)
In function "MathMultiply" : 
bad argument number 1(counting from 1) : 

The offending argument x evaluated to (90*Pi)/180
----

---- exponent bug.
+ 
#Sage calculates this.
var('k');
a = (1-x^2^k) * (1+x^2^k)
a,expand(a)
    ((1 - x^2^k)*(x^2^k + 1), 1 - x^(2*2^k))

//But piper calculates this.
%piper
    a := (1-x^2^k) * (1+x^2^k);
    Write(Simplify(a));

    %output
      1-x^2^k^2
    %end

%end


In> TestPiper(1-x^2^k^2,1 - x^(2*2^k))
Out> False:
******************
none: -1 
1-x^2^k^2 evaluates to 
1-x^2^k^2
 which differs from 
1-x^2^(k+1)
 by 
x^2^(k+1)-x^2^k^2
******************

----
+ Postfix function should be able to take only 1 argument, but it says it needs 2.
+ CDF link is broken in the PDF PiperDocs document.
+ TestPiper function should be renamed something more general like IsEquiv so that it can be used in other contexts.  For example, students learning how to manipulate an equation would find this function very useful.
+ Why does c := Sum(i,1,10,1/i*(i+1));Write(N(c)); Not convert c to a floating point value?
+ Why doesn't this work? "Object argument accessors in the form of
expr[ index ]. These are mapped internally to Nth(expr,index). The value of index=0 returns the operator of the object, index=1 the first argument, etc. So, if expr is foo(bar), then expr[0] returns foo, and expr[1] returns bar. Since lists of the form {...} are essentially the same as List(...), the same accessors can be used on lists."

+ If e is not defined, why is Ln(e) in this result?
%piper

df := D(x) 40*e^(-15000*x)*Sin(30000*x);
Write(df);

    %output
      40*e^(-15000*x)*30000*Cos(30000*x)+(-40)*e^(-15000*x)*15000*Ln(e)*Sin(30000*x)
    %end

%end

+ Why is Ln(2.71828) in this result?
%piper
e := 2.71828;
df := D(x) 40*e^(-15000*x)*Sin(30000*x);
Write(df);

    %output
      40*2.71828^(-15000*x)*30000*Cos(30000*x)+(-40)*2.71828^(-15000*x)*15000*Ln(2.71828)*Sin(30000*x)
    %end

%end


+ Why do some commands return True: while others return True with no : (Like Function);
+ What is FWatom in the factors.rep repository?
+ PrettyPrinter'Set: TexForm should be TeXForm.
+Note: the variable names "foreach..." have been chosen so they won't get confused with normal variables you use. This is a major design flaw in this language. Suppose there was a local variable foreachitem, defined in the calling function, and used in foreachbody. These two would collide, and the interpreter would use only the last defined version. In general, when writing a function that calls Eval(), it is a good idea to use variable names that can not collide with user's variables. This is generally the single largest cause of bugs when writing programs in Piper. This issue should be addressed in the future.
+ Random, RandomSeed in same string in .js array.
+ CachedConstant hyberlink in InNumericMode documentation is broken.
+ Wiesner Thomas to piper-devel
	
	I'm writing a small tutorial on CAS for hobby electronics.
	However, when I tried to solve a transcendental equation numerically, I
	encountered a Problem:
	
	RL:=1
	
	equ:=10e3*(2.68e-9*(Exp((9.75*Ln(IC/(7e-18*((4500-(68*IC+25500*IC+375*IC*RL))
	/23625+1)))+25500*IC+68*IC)/0.3588e2)-1)+IC/375)+(2*(9.75*Ln(IC
	/(7e-18*((4500-(68*IC+25500*IC+375*IC*RL))/23625+1)))
	+25500*IC+68*IC))/750-12==0
	
	Newton(equ[1], IC, 0.01, 1e-6) simply returns 'Undefined', but the equation has
	a (real) solution at 0.0051042 which can be found with Octave, for example.
	
	Additionally I don't understand why
	 Re(1/(I*w*c))
	gives
	 1/(Complex(0,1)*w*c)
	as result, but the correct result is simply 0. I thought, maybe piper assumes
	that w and c may be complex, but
	 Re(1/(I*Re(w*c)))
	doesn't work, too.
	
	Well, I thought maybe you want to know that.
	
	 mfg Thomas Wiesner
 
+ The Load command kills the contents of % which makes it impossible to access the
	result of the last evaluation.
+ Implement symbolic arithmetic so that m := 144 == 20 * a + b; n := 136 == 10 * a + b;c := m-n; works.
 
===

//What prime factors do the numbers 21, 42, and 56 have in common.
a := {};
a := Append(a,Factors(21));
a := Append(a,Factors(42));
a := Append(a,Factors(56));

//a := Flatten(a);
Echo(a);

     {{{%output 
      {{3,1},{7,1}} {{2,1},{3,1},{7,1}} {{2,3},{7,1}}
     }}}

Why is this list missing commas and curly braces?
===
+ Link from HoldArg to HoldArgNr in HoldArg documentation is broken.
}}}

{{{PIPER ENHANCEMENTS.
+ Rename Bin function to be Combinations.
+ Provide functions which generate lists which contain the combinations and permutations of a list.
+ How does one do parallel list traversals
+ Provide a way to convert between strings and lists.
+ %piper
a := {"00","20","40","60","08","28","48","68","88","A8","C8","E8","18","38","58","78","98","B8","D8","F8","8A","9A","AA","BA","CA","EA"};
b := {};
ForEach(x,a)
    [
        
       c := FromBase(16,x);
       Write(ToBase(2,c));
       NewLine();
    ];

%/piper
Base functions should be able to pad zeros on the left. (Also perhaps a more generalized Base function).
+ Change org.mathrider.piper.Piper.Evaluate to evaluate.
+ Change Numer to Numerator and Denom to Denominator because it is hard to remember how many letters of Numer and Denom are used in the shorter names.
+ Change "generic" (as in Generic object) to "native".
+ Change Nl to NL.
+ Change TeXForm to TexForm.
+ Change FullForm to LispForm.
+ Change MathXXX function names to XXXN format or perhaps have something like SinS for symbolic and SinN for numeric (but then all symbolic functions should be labeled as such so maybe just labeling the numeric ones would be best.
+ Change DestructiveXXX function names to XXXO for Original and perhaps functions like Replace to ReplaceC for Copy.
+ Change function names which have a ' in them to version without '.
+ Have commands which are similar to scientific calculator functions (like NCR, NPR, etc).
+ Multivariate factoring.

----
+ Regular expressions
The regular expressions plugin
This plugin allows for text processing using regular expressions. The GPL'ed package pcre is included for this purpose (pcre stands for Perl compatible regular expressions).

To use the plugin, the plugin has to be loaded through:

Use("pcre");

The pcre plugin offers two principal functions: PcreLexer and PcreNextToken. PcreLexer sets up and initializes the tokenizer to scan for a set of regular expressions. A call to PcreNextToken returns the result of the scan in the current file, starting from the current position.

PcreLexer does not interfere with normal reading of a file. When normal read calls are made, the default tokenizer is used. The tokenizer set up by PcreLexer is only used when PcreNextToken is called.

The syntax for PcreLexer is:

PcreLexer(tokens);

The argument tokens is a list of token definitions. A token definition in turn is a list, with the first element a string containing the regular expression, and the second containing an atom that can describe the type of the token (for easy recognition later).

Calling PcreNextToken() will then return the first matching token from the current input.

The following example sets up the tokenizer to recognize either an integer, or a word consisting only of lowercase letters.

In> DllLoad("pcre")
Out> True
In> PcreLexer({{"[0-9]+",Integer},{"[a-z]+",Word}})
Out> True
In> FromString("123abc")PcreNextToken()
Out> {"123",Integer}
In> FromString("===abc")PcreNextToken()
Out> {"abc",Word}

----
From Axel:
In the refactored sources I've tried to:
* use generic HashMap<...,...> there possible instead of Hashtable and
eliminated some Hashtable wrapper classes
* use equals() method instead of "==" "!=" operator for Strings, but
there is still a problem, because I didn't get rid of the (new)
StringUtil.intern() method!

IMO also the package structure should be refactored to easier maintain
the piper API
* all PiperEvaluator based classes should go in their own package and
not be included as MathCommand subclasses.
* the parser classes should be in an own package
* the LispObject based classes should go in their own package
* the SBox based classes should go in their own package and not be
included as SBoxBuilder subclasses.
----
}}}

{{{Piper questions.
+ How does one expand 2^3 into 2*2*2?
}}}


{{{====jedit_gui.props
insert-newline-indent.shortcut=  //Turn off auto indent after newline.
}}}


{{{====PIPER INFORMATION

How to stop a calculation:
  public void StopCurrentCalculation()
  {
    piper.env.iEvalDepth = piper.env.iMaxEvalDepth+100;
  }
  
----
Packages:

{{{io: 
LispInput (abstract)
StringInput
JarInputFile
LispOutput (abstract)
StdFileOutput
StringOutput
}}}



LispObject (abstract)
/** class LispObject is the base object class that can be put in
 *  linked lists. It either has a pointer to a string, obtained through
 *  String(), or it is a holder for a sublist, obtainable through SubList(),
 *  or it is a generic object, in which case Generic() returns non-NULL.
 *  Only one of these three functions should return a non-NULL value.
 *  It is a reference-counted object. LispPtr handles the reference counting.
 */
 
LispPtr
/** class LispPtr. This class is a smart pointer type class to Lisp
 *  objects that can be inserted into linked lists. They do the actual
 *  reference counting, and consequent destruction of the object if
 *  nothing points to it. LispPtr is used in LispObject as a pointer
 *  to the next object, and in diverse parts of the built-in internal
 *  functions to hold temporary values.
 */
 
 


}}}

{{{====Should the Plot2D and Plot3D returned data interfaces be unified?
}}}


{{{====Determining if an error was encountered.

String response = piper.Evaluate(expression);

if (piper.iError != null)
{
  AddLinesStatic(48,"Error> ",piper.iError);
}
}}}


{{{===="Notebook" thoughts.

+ One could create a html-based notebook like the Sage notebook but perhaps it would be better to create a 100% Applet-based notebook which would use a layout manager to lay components out in a vertical fasion.  The mathrider application can generate online notebooks which is similar to the way that GeoGebra generates online viewers.

+ Perhaps it would be useful to put together text documents in a mrw file so that macros can be developed in the same document as the text ?
}}}

{{{====Calculator thoughts.
- Include multiple calculator plugins and create a way for them to interoperate with Piper.
}}}


{{{====Tango icons
http://sourceforge.net/tracker/index.php?func=detail&aid=1755992&group_id=588&atid=300588
}}}

{{{====Beansheet
+ Changing alignment of cells that have different fonts sets all cells to the same font.

}}}


{{{ ====HotEqn bugs.
%piper,output="latex"

a := Hold( ((k+1)/(2*k)) * (1-(1/(K+1)^2)) );

Write(a);

    %hoteqn
      $\frac{k + 1}{2 k}  \left( 1 - \frac{1}{\left( K + 1\right)  ^{2}} \right) $

        %output
          HotEqn updated.
        %end

    %end

%end
----
//The latex produced by this code does not render properly.
%piper,output="latex"
a := -4.472*(sin(2*x+86.56) + 2*cos(2*x + 86.56));
b := 10 * sin(2*x -30);
Write(a);
%/piper

    %hoteqn,preserve="false"
      - 4.472 \left( \mathrm{ sin }\left( 2 x + 86.56\right)  + 2 \mathrm{ cos }\left( 2 x + 86.56\right) \right)
    %/hoteqn

        %output,preserve="false"
          HotEqn updated.
        %/output
----
}}}


{{{ CONTEXT DEPENDENT "RIGHT CLICK" POPUP MENU
+ On fold header: Dialog which allows properties to selected graphically.
+ In fold: Pop up list of commands depending on fold type.

}}}


{{{Sage disadvantages:
+ The implementation is constantly changing beneath you without warning.
}}}

{{{GeoGebra
+ The Curve command does not work for some reason.
+ Copy XML protocol to clipboard.
+ Add commands for setting object properties so that these can be set by a program.
+ XML format does not allow comments but should.
+ Place scroll arrows on the axes.
+ Add a zoom slider.
+ Add an auto-fit button.
+ Enable the user to draw rectangles on the top of a graph in order to estimate areas.
}}}

{{{SUBVERSION
+ And keep in mind, Subversion can handle binary files as well as text files, so I'd highly recommnd storing EVERYTHING in your repository, be it your development tools (Eclipse), external libraries (any JARs or DLLs your app might need), server configuration files (web server, DB server), bootstrap scripts, etc.  Aside from hardware and system software, creating a new environment to run your application shouldn't require anything that's not stored in version control.


}}}


{{{JSciCalc
+ Fix white patched in display.
+ Add factorial button.
+ Confrey's Function Probe had a calculator in which you could make your own new buttons, and with a record of what you had done, like the TI calculators, or dc in unix. Susan.


}}}


{{{JEDIT
Perhaps you can package your software so that it can be used one way
(as a standalone program) but also available as a plugin for users of
jEdit? That would certainly be cool. It's just a matter of keeping a
good discipline and separating your code from the core code, and
putting it all in a plugin, and then having the plugin set some
default options in its props file. -Alan Ezust.
----
This is the chronic Jython error in JEdit:
11:41:50 PM [error] JythonExecutor: Traceback (innermost last):
11:41:50 PM [error] JythonExecutor:   (no code object) at line 0
11:41:50 PM [error] JythonExecutor: KeyError: console
----
11:53:44 PM [error] JythonExecutor: Traceback (innermost last):
11:53:44 PM [error] JythonExecutor:   (no code object) at line 0
11:53:44 PM [error] JythonExecutor: KeyError: PyParser
----
}}}

{{{CLOJURE

 	
====		
Ray Myers   	
View profile
	 More options Jun 27, 8:32 pm
From: Ray Myers <ray.my...@gmail.com>
Date: Fri, 27 Jun 2008 17:32:50 -0700 (PDT)
Local: Fri, Jun 27 2008 8:32 pm
Subject: Calling Clojure from Java (Shortcuts)
Reply | Reply to author | Forward | Print | Individual message | Show original | Report this message | Find messages by this author
Hello,

Evaluating arbitrary Clojure code from Java seems to be a common
stumbling block, so I put together a simple utility to wrap the
process. Please let me know if the attached code is a reasonable way
to do this.

One issue is that the callers of runClosureScript() all share and
modify the same lexical environment. Is it possible to prevent this?

Cheers,
-- Ray Myers

import java.io.StringReader;
import java.util.HashMap;
import java.util.Map;
import java.util.Map.Entry;

import clojure.lang.Associative;
import clojure.lang.Binding;
import clojure.lang.Compiler;
import clojure.lang.Namespace;
import clojure.lang.PersistentHashMap;
import clojure.lang.RT;
import clojure.lang.Symbol;
import clojure.lang.Var;

public class ClojureScriptRunner {

        public static Object runClosureScript(Map<String, ? extends Object>
bindings, String script)
                        throws Exception {
                try {
                        new Binding<String>(script);
                        Namespace ns = (Namespace) RT.CURRENT_NS.get();
                        Associative mappings = PersistentHashMap.EMPTY;
                        mappings = mappings.assoc(RT.CURRENT_NS, RT.CURRENT_NS.get());
                        for (Entry<String, ? extends Object> e : bindings.entrySet()) {
                                String varName = e.getKey();
                                Symbol sym = Symbol.intern(varName);
                                Var var = Var.intern(ns, sym);
                                mappings = mappings.assoc(var, e.getValue());
                        }
                        Var.pushThreadBindings(mappings);
                        return Compiler.load(new StringReader(script));
                } finally {
                        Var.popThreadBindings();
                }
        }

        // Example
        public static void main(String[] args) throws Exception {
                Map<String, Integer> bindings = new HashMap<String, Integer>();
                bindings.put("a", 2);
                bindings.put("b", 3);
                System.out.println(runClosureScript(bindings, "(+ a b)")); // prints
5
        }

- Hide quoted text -
- Show quoted text -
}


    Reply    Reply to author    Forward       Rate this post: Text for clearing space
		
		
		
You must Sign in before you can post messages.
To post a message you must first join this group.
Please update your nickname on the subscription settings page before posting.
You do not have the permission required to post.
	
		
Chas Emerick   	
View profile
	 More options Jun 28, 10:20 am
From: Chas Emerick <cemer...@snowtide.com>
Date: Sat, 28 Jun 2008 07:20:41 -0700 (PDT)
Local: Sat, Jun 28 2008 10:20 am
Subject: Re: Calling Clojure from Java (Shortcuts)
Reply | Reply to author | Forward | Print | Individual message | Show original | Report this message | Find messages by this author

On Jun 27, 8:32 pm, Ray Myers <ray.my...@gmail.com> wrote:

> One issue is that the callers of runClosureScript() all share and
> modify the same lexical environment. Is it possible to prevent this?

Having a single environment is an intentional design decision,
primarily to ensure efficient operation.  I asked this same question
some time ago, in the context of comparing Clojure to SISC, which has
a Runtime class that you can create and therefore use to have multiple
execution environments within the same JVM.  Rich's response was:

"[Clojure is designed that way] for speed. Multiple runtimes means
reified environments and a runtime lookup for every var reference.
Clojure var references get compiled into fns as static members and
looked up once only during load."

FWIW, I did some very informal benchmarking of SISC vs. Clojure in
January, and Clojure was easily two orders of magnitude faster.  I'd
say I was equally unskilled in both environments at the time, so maybe
there's some tricks to be had in SISC-land that would have helped
some.  Regardless, the upshot of those results were/are hard to argue
with, at least for me.

- Chas 

====
It seems most people are having problems either:

 With a runtime error in code entered in the repl (or sent from an
editor buffer), rather than loaded, where there are no relevant source
line numbers to use.
====

}}}


{{{ U6502
+ If a label is placed in the operation column, an exception is thrown.
- Add reset method to IOChip interface.
+ This line should cause an error in the assembler but it doesn't: "sum	dbt d". Notice it is missing a value before d.
+ Branching to addresses throws a "string out of bounds" exception in a uasm65 fold.
+ Make ROM read only in the emulator.
+ Enter Copy button and popup menu to U6502.
+ Make an ASCII chart plugin.
}}}


{{{Axiom bugs =========== 0.1.15
+ (3) -> draw(5*besselJ(0,sqrt(x**2+y**2)), x=-20..20, y=-20..20)  


}}}


